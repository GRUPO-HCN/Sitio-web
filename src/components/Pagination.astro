---
/**
 * Numeric pagination with prev/next arrows.
 * Expects Astro's Page object from paginate().
 */
interface Props {
  currentPage: number;
  lastPage: number;
  baseUrl: string; // e.g. "/productos"
}

const { currentPage, lastPage, baseUrl } = Astro.props;

/** Build the URL for a given page number */
function pageUrl(page: number): string {
  if (page === 1) return `${baseUrl}/`;
  return `${baseUrl}/${page}/`;
}

// Build visible page numbers (show max 7 with ellipsis)
function getPageNumbers(): (number | '...')[] {
  const pages: (number | '...')[] = [];
  if (lastPage <= 7) {
    for (let i = 1; i <= lastPage; i++) pages.push(i);
    return pages;
  }
  // Always show first
  pages.push(1);
  if (currentPage > 3) pages.push('...');
  // Middle range
  const start = Math.max(2, currentPage - 1);
  const end = Math.min(lastPage - 1, currentPage + 1);
  for (let i = start; i <= end; i++) pages.push(i);
  if (currentPage < lastPage - 2) pages.push('...');
  // Always show last
  pages.push(lastPage);
  return pages;
}

const pageNumbers = getPageNumbers();
const hasPrev = currentPage > 1;
const hasNext = currentPage < lastPage;
---

{lastPage > 1 && (
  <nav class="mt-12 flex items-center justify-center gap-1" aria-label="Paginación">
    <!-- Previous -->
    {hasPrev ? (
      <a
        href={pageUrl(currentPage - 1)}
        class="inline-flex h-10 w-10 items-center justify-center rounded-lg border border-gray-300 bg-white text-gray-600 transition-all duration-200 hover:border-cyan-300 hover:text-cyan-600 dark:border-gray-600 dark:bg-gray-800 dark:text-gray-300 dark:hover:border-cyan-600 dark:hover:text-cyan-400"
        aria-label="Página anterior"
      >
        <svg class="h-4 w-4" fill="none" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor"><path stroke-linecap="round" stroke-linejoin="round" d="M15.75 19.5L8.25 12l7.5-7.5"/></svg>
      </a>
    ) : (
      <span class="inline-flex h-10 w-10 items-center justify-center rounded-lg border border-gray-200 bg-gray-50 text-gray-300 cursor-not-allowed dark:border-gray-700 dark:bg-gray-800/50 dark:text-gray-600" aria-disabled="true">
        <svg class="h-4 w-4" fill="none" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor"><path stroke-linecap="round" stroke-linejoin="round" d="M15.75 19.5L8.25 12l7.5-7.5"/></svg>
      </span>
    )}

    <!-- Page numbers -->
    {pageNumbers.map(p => {
      if (p === '...') {
        return (
          <span class="inline-flex h-10 w-10 items-center justify-center text-sm text-gray-400 dark:text-gray-500">...</span>
        );
      }
      const isCurrent = p === currentPage;
      return isCurrent ? (
        <span
          class="inline-flex h-10 w-10 items-center justify-center rounded-lg bg-cyan-500 text-sm font-semibold text-white"
          aria-current="page"
        >
          {p}
        </span>
      ) : (
        <a
          href={pageUrl(p)}
          class="inline-flex h-10 w-10 items-center justify-center rounded-lg border border-gray-300 bg-white text-sm font-medium text-gray-700 transition-all duration-200 hover:border-cyan-300 hover:text-cyan-600 dark:border-gray-600 dark:bg-gray-800 dark:text-gray-300 dark:hover:border-cyan-600 dark:hover:text-cyan-400"
        >
          {p}
        </a>
      );
    })}

    <!-- Next -->
    {hasNext ? (
      <a
        href={pageUrl(currentPage + 1)}
        class="inline-flex h-10 w-10 items-center justify-center rounded-lg border border-gray-300 bg-white text-gray-600 transition-all duration-200 hover:border-cyan-300 hover:text-cyan-600 dark:border-gray-600 dark:bg-gray-800 dark:text-gray-300 dark:hover:border-cyan-600 dark:hover:text-cyan-400"
        aria-label="Página siguiente"
      >
        <svg class="h-4 w-4" fill="none" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor"><path stroke-linecap="round" stroke-linejoin="round" d="M8.25 4.5l7.5 7.5-7.5 7.5"/></svg>
      </a>
    ) : (
      <span class="inline-flex h-10 w-10 items-center justify-center rounded-lg border border-gray-200 bg-gray-50 text-gray-300 cursor-not-allowed dark:border-gray-700 dark:bg-gray-800/50 dark:text-gray-600" aria-disabled="true">
        <svg class="h-4 w-4" fill="none" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor"><path stroke-linecap="round" stroke-linejoin="round" d="M8.25 4.5l7.5 7.5-7.5 7.5"/></svg>
      </span>
    )}
  </nav>
)}
